<!DOCTYPE html>
<html lang="en">
<!-- Previous head content remains the same -->
<body>
    <!-- Previous body content remains the same -->
    <script>
        const ENDPOINTS = [
            'https://solana-api.projectserum.com',
            'https://api.mainnet-beta.solana.com',
            'https://rpc.ankr.com/solana'
        ];

        async function tryConnection(endpoints) {
            for (let endpoint of endpoints) {
                try {
                    const connection = new solanaWeb3.Connection(endpoint, 'confirmed');
                    // Test the connection
                    await connection.getBlockHeight();
                    return connection;
                } catch (error) {
                    console.log(`Failed to connect to ${endpoint}:`, error);
                    continue;
                }
            }
            throw new Error('All endpoints failed');
        }

        document.getElementById('walletButton').addEventListener('click', function() {
            const button = this;
            const buttonContainer = button.parentElement;
            
            // Create input field
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'Enter SOL wallet address';
            input.className = 'wallet-input';
            input.style.width = button.offsetWidth + 'px';
            input.style.height = button.offsetHeight + 'px';
            
            // Create check button
            const checkButton = document.createElement('button');
            checkButton.textContent = 'Check';
            checkButton.className = 'btn check-btn';
            
            // Animate button to input transition
            button.style.transition = 'all 0.3s ease';
            button.style.opacity = '0';
            
            setTimeout(() => {
                button.style.display = 'none';
                buttonContainer.insertBefore(input, button);
                buttonContainer.insertBefore(checkButton, button);
                
                // Add event listener for the check button
                checkButton.addEventListener('click', async () => {
                    const walletAddress = input.value.trim();
                    if (!walletAddress) {
                        alert('Please enter a wallet address');
                        return;
                    }
                    
                    checkButton.textContent = 'Checking...';
                    checkButton.disabled = true;

                    try {
                        // Validate Solana address format
                        const publicKey = new solanaWeb3.PublicKey(walletAddress);
                        
                        // Try to establish connection
                        const connection = await tryConnection(ENDPOINTS);
                        
                        // KIRA token mint address
                        const KIRA_TOKEN_ADDRESS = 'GyCNKRGU5t7mvVQVyrtP1hPwdq1V29GAP54HvwhVpump';
                        
                        console.log('Checking wallet:', walletAddress);
                        console.log('Looking for token:', KIRA_TOKEN_ADDRESS);

                        // Get token accounts for the wallet
                        const tokenAccounts = await connection.getParsedTokenAccountsByOwner(
                            publicKey,
                            {
                                mint: new solanaWeb3.PublicKey(KIRA_TOKEN_ADDRESS)
                            }
                        );
                        
                        console.log('Token accounts found:', tokenAccounts);

                        if (tokenAccounts.value.length > 0) {
                            const tokenAmount = tokenAccounts.value[0].account.data.parsed.info.tokenAmount.uiAmount;
                            console.log('Token amount:', tokenAmount);
                            
                            if (tokenAmount > 0) {
                                document.getElementById('chatContainer').style.display = 'block';
                                input.style.borderColor = '#00ff00';
                                checkButton.textContent = `Verified âœ“ (${tokenAmount} KIRA)`;
                                checkButton.style.backgroundColor = '#00ff00';
                            } else {
                                input.style.borderColor = '#ff0000';
                                checkButton.textContent = 'No KIRA tokens found';
                                checkButton.style.backgroundColor = '#ff0000';
                            }
                        } else {
                            input.style.borderColor = '#ff0000';
                            checkButton.textContent = 'No KIRA tokens found';
                            checkButton.style.backgroundColor = '#ff0000';
                        }
                    } catch (error) {
                        console.error('Detailed error:', error);
                        input.style.borderColor = '#ff0000';
                        checkButton.textContent = 'Error checking wallet';
                        checkButton.style.backgroundColor = '#ff0000';
                    }
                    
                    checkButton.disabled = false;
                });
            }, 300);
        });

        // Previous message handling code remains the same
    </script>
</body>
</html>
